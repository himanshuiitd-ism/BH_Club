import React, { useState, useRef, useEffect } from "react";

const EmojiSelector = ({
  onEmojiSelect,
  isOwnMessage,
  onClose,
  position = "bottom",
}) => {
  const [selectedCategory, setSelectedCategory] = useState("smileys");
  const selectorRef = useRef(null);

  const emojiCategories = {
    smileys: {
      name: "😊 Smileys",
      emojis: [
        "😀",
        "😃",
        "😄",
        "😁",
        "😆",
        "😅",
        "🤣",
        "😂",
        "🙂",
        "🙃",
        "😉",
        "😊",
        "😇",
        "🥰",
        "😍",
        "🤩",
        "😘",
        "😗",
        "😚",
        "😙",
        "😋",
        "😛",
        "😜",
        "🤪",
        "😝",
        "🤑",
        "🤗",
        "🤭",
        "🤫",
        "🤔",
        "🤐",
        "🤨",
        "😐",
        "😑",
        "😶",
        "😏",
        "😒",
        "🙄",
        "😬",
        "🤥",
        "😔",
        "😪",
        "🤤",
        "😴",
        "😷",
        "🤒",
        "🤕",
        "🤢",
        "🤮",
        "🤧",
        "🥵",
        "🥶",
        "🥴",
        "😵",
        "🤯",
        "🤠",
        "🥳",
        "😎",
        "☠️",
        "💀",
      ],
    },
    gestures: {
      name: "👍 Gestures",
      emojis: [
        "👍",
        "👎",
        "👌",
        "🤏",
        "✌️",
        "🤞",
        "🤟",
        "🤘",
        "🤙",
        "👈",
        "👉",
        "👆",
        "🖕",
        "👇",
        "☝️",
        "👏",
        "🙌",
        "👐",
        "🤲",
        "🤝",
        "🙏",
        "✍️",
        "💪",
        "🦾",
        "🦵",
        "🦿",
        "💄",
        "💋",
        "👄",
        "🦷",
        "👅",
        "👂",
        "🦻",
        "👃",
        "👣",
        "👁️",
        "👀",
        "🧠",
        "🫀",
        "🫁",
        "🩸",
        "👶",
        "🧒",
        "👦",
        "👧",
        "🧑",
        "👱",
        "👨",
        "🧔",
        "👨‍🦰",
        "👨‍🦱",
        "👨‍🦳",
        "👨‍🦲",
        "👩",
        "👩‍🦰",
        "👩‍🦱",
        "👩‍🦳",
        "👩‍🦲",
      ],
    },
    hearts: {
      name: "❤️ Hearts",
      emojis: [
        "❤️",
        "🧡",
        "💛",
        "💚",
        "💙",
        "💜",
        "🖤",
        "🤍",
        "🤎",
        "💔",
        "❣️",
        "💕",
        "💞",
        "💓",
        "💗",
        "💖",
        "💘",
        "💝",
        "💟",
        "♥️",
        "💯",
        "💢",
        "💥",
        "💫",
        "💦",
        "💨",
        "🕳️",
        "💣",
        "💬",
        "👁️‍🗨️",
        "🗨️",
        "🗯️",
        "💭",
        "💤",
      ],
    },
    animals: {
      name: "🐶 Animals",
      emojis: [
        "🐶",
        "🐱",
        "🐭",
        "🐹",
        "🐰",
        "🦊",
        "🐻",
        "🐼",
        "🐨",
        "🐯",
        "🦁",
        "🐮",
        "🐷",
        "🐽",
        "🐸",
        "🐵",
        "🙈",
        "🙉",
        "🙊",
        "🐒",
        "🐔",
        "🐧",
        "🐦",
        "🐤",
        "🐣",
        "🐥",
        "🦆",
        "🦅",
        "🦉",
        "🦇",
        "🐺",
        "🐗",
        "🐴",
        "🦄",
        "🐝",
        "🐛",
        "🦋",
        "🐌",
        "🐞",
        "🐜",
        "🦟",
        "🦗",
        "🕷️",
        "🕸️",
        "🦂",
        "🐢",
        "🐍",
        "🦎",
        "🦖",
        "🦕",
        "🐙",
        "🦑",
        "🦐",
        "🦞",
        "🦀",
        "🐡",
        "🐠",
        "🐟",
        "🐬",
        "🐳",
        "🐋",
        "🦈",
        "🐊",
        "🐅",
        "🐆",
        "🦓",
        "🦍",
        "🦧",
        "🐘",
        "🦛",
        "🦏",
        "🐪",
        "🐫",
        "🦒",
        "🦘",
        "🐃",
        "🐂",
        "🐄",
        "🐎",
        "🐖",
        "🐏",
        "🐑",
        "🦙",
        "🐐",
        "🦌",
        "🐕",
        "🐩",
        "🦮",
        "🐕‍🦺",
        "🐈",
        "🐈‍⬛",
        "🐓",
        "🦃",
        "🦚",
        "🦜",
        "🦢",
        "🦩",
        "🕊️",
        "🐇",
        "🦝",
        "🦨",
        "🦡",
        "🦦",
        "🦥",
        "🐁",
        "🐀",
        "🐿️",
      ],
    },
    food: {
      name: "🍕 Food",
      emojis: [
        "🍎",
        "🍐",
        "🍊",
        "🍋",
        "🍌",
        "🍉",
        "🍇",
        "🍓",
        "🫐",
        "🍈",
        "🍒",
        "🍑",
        "🥭",
        "🍍",
        "🥥",
        "🥝",
        "🍅",
        "🍆",
        "🥑",
        "🥦",
        "🥬",
        "🥒",
        "🌶️",
        "🫑",
        "🌽",
        "🥕",
        "🫒",
        "🧄",
        "🧅",
        "🥔",
        "🍠",
        "🥐",
        "🥯",
        "🍞",
        "🥖",
        "🥨",
        "🧀",
        "🥚",
        "🍳",
        "🧈",
        "🥞",
        "🧇",
        "🥓",
        "🥩",
        "🍗",
        "🍖",
        "🦴",
        "🌭",
        "🍔",
        "🍟",
        "🍕",
        "🫓",
        "🥪",
        "🥙",
        "🧆",
        "🌮",
        "🌯",
        "🫔",
        "🥗",
        "🥘",
        "🫕",
        "🍝",
        "🍜",
        "🍲",
        "🍛",
        "🍣",
        "🍱",
        "🥟",
        "🦪",
        "🍤",
        "🍙",
        "🍚",
        "🍘",
        "🍥",
        "🥠",
        "🥮",
        "🍢",
        "🍡",
        "🍧",
        "🍨",
        "🍦",
        "🥧",
        "🧁",
        "🍰",
        "🎂",
        "🍮",
        "🍭",
        "🍬",
        "🍫",
        "🍿",
        "🍩",
        "🍪",
        "🌰",
        "🥜",
        "🍯",
      ],
    },
    activities: {
      name: "⚽ Activities",
      emojis: [
        "⚽",
        "🏀",
        "🏈",
        "⚾",
        "🥎",
        "🎾",
        "🏐",
        "🏉",
        "🥏",
        "🎱",
        "🪀",
        "🏓",
        "🏸",
        "🏒",
        "🏑",
        "🥍",
        "🏏",
        "🪃",
        "🥅",
        "⛳",
        "🪁",
        "🏹",
        "🎣",
        "🤿",
        "🥽",
        "🥼",
        "🦺",
        "⛷️",
        "🏂",
        "🏄",
        "🏄‍♂️",
        "🏄‍♀️",
        "🚣",
        "🚣‍♂️",
        "🚣‍♀️",
        "🏊",
        "🏊‍♂️",
        "🏊‍♀️",
        "⛹️",
        "⛹️‍♂️",
        "⛹️‍♀️",
        "🏋️",
        "🏋️‍♂️",
        "🏋️‍♀️",
        "🚴",
        "🚴‍♂️",
        "🚴‍♀️",
        "🚵",
        "🚵‍♂️",
        "🚵‍♀️",
        "🤸",
        "🤸‍♂️",
        "🤸‍♀️",
        "🤼",
        "🤼‍♂️",
        "🤼‍♀️",
        "🤽",
        "🤽‍♂️",
        "🤽‍♀️",
        "🤾",
        "🤾‍♂️",
        "🤾‍♀️",
        "🤹",
        "🤹‍♂️",
        "🤹‍♀️",
        "🧘",
        "🧘‍♂️",
        "🧘‍♀️",
        "🛀",
        "🛌",
      ],
    },
  };

  useEffect(() => {
    const handleClickOutside = (event) => {
      if (selectorRef.current && !selectorRef.current.contains(event.target)) {
        onClose();
      }
    };

    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, [onClose]);

  const handleEmojiClick = (emoji) => {
    onEmojiSelect(emoji);
    onClose();
  };

  return (
    <div
      className={`emoji-selector ${position} ${
        isOwnMessage ? "ownEmojiSelector" : "otherEmojiSelector"
      }`}
      ref={selectorRef}
    >
      <div className="emoji-selector-header">
        <h4>Choose a reaction</h4>
        <button className="close-btn" onClick={onClose}>
          ×
        </button>
      </div>

      <div className="emoji-categories">
        {Object.entries(emojiCategories).map(([key, category]) => (
          <button
            key={key}
            className={`category-btn ${
              selectedCategory === key ? "active" : ""
            }`}
            onClick={() => setSelectedCategory(key)}
          >
            {category.name.split(" ")[0]}
          </button>
        ))}
      </div>

      <div className="emoji-grid">
        {emojiCategories[selectedCategory].emojis.map((emoji, index) => (
          <button
            key={index}
            className="emoji-btn"
            onClick={() => handleEmojiClick(emoji)}
          >
            {emoji}
          </button>
        ))}
      </div>
    </div>
  );
};

export default EmojiSelector;
